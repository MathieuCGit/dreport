#!/bin/bash
#This script generated the list of contained in plugins-available/ directory and put it into settings file.
#It also generates the help file using plugins-available/ directory and language_CC files.
#Written by Mathieu CONAN

source "conf.main"

#_/ Create plugins list and settings files \_______________________________
echo '#!/bin/bash
#this script is automatically generated by the install script. Please,
#run ./install instead of editing manually this script.
#Written By Mathieu CONAN
' > settings

echo 'case $2 in' >> settings

for file in `ls -1 $PLUGINS_PATH_AVAILABLE/`; do
  echo -e '\t--'$file')source "'$PLUGINS_PATH_AVAILABLE/$file'";;' >> settings
done
echo '	*)echo "Unknow option, please try dreport -h";exit;;
esac' >> settings

#_/ Create Help file \_______________________________________________________
echo '#!/bin/bash
#Help file you obtain when you enter dreport -h in a command line
#Written By Mathieu CONAN

UsageError="\t$MAIN_SCRIPT_NAME [-h] [-a] [-smHd] [-c --[settings]] \n"

	echo -e "USAGE : \n"
	echo -e  $UsageError
	echo -e "PARAM: \n"
	echo -e "\t_____________________________________________________________\n"
	echo -e "\t\t-h\t$HELP_MSG_HELP\n"
	echo -e "\t_____________________________________________________________\n"
	echo -e "\t\t-a\t$HELP_MSG_PARAM_SHOW_ENABLED_PLUGINS\n"
	echo -e "\t_____________________________________________________________\n"
	echo -e "\t\t-s\t$HELP_MSG_PARAM_SECONDES\n"
	echo -e "\t\t-m\t$HELP_MSG_PARAM_MINUTES\n"
	echo -e "\t\t-H\t$HELP_MSG_PARAM_HOURS\n"
	echo -e "\t\t-d\t$HELP_MSG_PARAM_DAYS\n"
	echo -e "\t_____________________________________________________________\n"
	echo -e "\t\t-c --settings\t\t$HELP_MSG_CONFIG\n"
' > "help"

for file in `ls -1 $PLUGINS_PATH_AVAILABLE/`; do
  #this line manage the tab lenght for help layout, not really indispensable, just pretty :)
  if [[ ${#file} -le 4 ]];then tabulation="\t\t";else tabulation="\t";fi

  #scan plugin directory and associate help msg contained in language_CC files
  echo 'echo -e "\t\t\t--'$file $tabulation'$HELP_MSG_PARAM_'$file'"' >> "help"
done
